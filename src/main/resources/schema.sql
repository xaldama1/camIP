
DROP SCHEMA PUBLIC CASCADE;

CREATE SEQUENCE IPSEQUENCE AS BIGINT
    START WITH 1 INCREMENT BY 1;
    
CREATE SEQUENCE DEVICESEQUENCE AS BIGINT
    START WITH 1 INCREMENT BY 1;
    
CREATE SEQUENCE DEVICETOKENSEQUENCE AS BIGINT
    START WITH 1 INCREMENT BY 1;
    
CREATE SEQUENCE DEVICECHECKERSEQUENCE AS BIGINT
    START WITH 1 INCREMENT BY 1;
    
CREATE SEQUENCE RULESEQUENCE AS BIGINT
    START WITH 1 INCREMENT BY 1;

CREATE TABLE IF NOT EXISTS MALICIOUS_IP (
  id bigint GENERATED BY DEFAULT AS SEQUENCE IPSEQUENCE PRIMARY KEY ,
  ip varchar(16) DEFAULT NULL,
  lastupdate TIMESTAMP DEFAULT NULL,
  origin varchar(50) DEFAULT NULL
);

CREATE TABLE IF NOT EXISTS DEVICE (
  id bigint GENERATED BY DEFAULT AS SEQUENCE DEVICESEQUENCE PRIMARY KEY ,
  ip varchar(16) DEFAULT NULL,
  mac varchar(17) DEFAULT NULL,
  name varchar(50) DEFAULT NULL,
  detected TIMESTAMP DEFAULT NULL,
  lastupdate TIMESTAMP DEFAULT NULL
);

CREATE TABLE IF NOT EXISTS DEVICETOKEN (
  id bigint GENERATED BY DEFAULT AS SEQUENCE DEVICETOKENSEQUENCE PRIMARY KEY ,
  token varchar(150) DEFAULT NULL,
  device_id bigint DEFAULT NULL
);

ALTER TABLE DEVICETOKEN
  ADD FOREIGN KEY (device_id) REFERENCES DEVICE(id);
  
CREATE TABLE IF NOT EXISTS DEVICECHECKER (
  id bigint GENERATED BY DEFAULT AS SEQUENCE DEVICECHECKERSEQUENCE PRIMARY KEY ,
  checker varchar(150) DEFAULT NULL,
  status varchar(150) DEFAULT NULL,
  device_id bigint DEFAULT NULL
);

ALTER TABLE DEVICECHECKER
  ADD FOREIGN KEY (device_id) REFERENCES DEVICE(id);
  
    
CREATE TABLE IF NOT EXISTS RULE (
  id bigint GENERATED BY DEFAULT AS SEQUENCE RULESEQUENCE PRIMARY KEY ,
  rule varchar(150) DEFAULT NULL,
  activeuntil TIMESTAMP DEFAULT NULL
);